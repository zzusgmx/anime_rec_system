<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>量子态动漫推荐系统 - 用户中心</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Font Awesome 图标库 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

  <!-- 自定义CSS -->
  <link rel="stylesheet" href="/static/css/interaction.css">
  <link rel="stylesheet" href="/static/recommendation/css/recommendation-enhanced.css">

  <!-- 添加数据可视化CSS -->
  <link rel="stylesheet" href="/static/recommendation/css/visualization.css">

  <!-- ECharts 库 -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.0/echarts.min.js"></script>

  <!-- 核心脚本预加载 - 量子加速流水线 -->
  <link rel="preload" href="/static/recommendation/js/dashboard.js" as="script">
  <link rel="preload" href="/static/recommendation/js/exploration-controller.js" as="script">
  <link rel="preload" href="/static/recommendation/js/visualization.js" as="script">

  <style>
    :root {
      --primary: #6d28d9;
      --primary-dark: #5b21b6;
      --primary-light: #8b5cf6;
      --secondary: #10b981;
      --secondary-dark: #059669;
      --dark: #1e293b;
      --light: #f8fafc;
      --card-bg: #ffffff;
      --accent: #f97316;
      --quantum-gradient: linear-gradient(135deg, #6d28d9, #8b5cf6, #10b981);
    }

    /* 全局样式 */
    body {
      font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', sans-serif;
      background: #f0f2f5;
      color: var(--dark);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* 导航栏 */
    .navbar {
      background: var(--quantum-gradient);
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      padding: 0.75rem 1.5rem;
    }

    .navbar-brand {
      color: white;
      font-weight: 700;
      font-size: 1.4rem;
      display: flex;
      align-items: center;
    }

    .navbar-brand i {
      margin-right: 10px;
      font-size: 1.5rem;
    }

    .nav-link {
      color: rgba(255, 255, 255, 0.85) !important;
      font-weight: 500;
      padding: 0.5rem 1rem;
      position: relative;
      transition: all 0.3s ease;
    }

    .nav-link:hover {
      color: white !important;
    }

    .nav-link.active {
      color: white !important;
    }

    .nav-link.active::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 1rem;
      right: 1rem;
      height: 3px;
      background-color: var(--accent);
      border-radius: 3px 3px 0 0;
    }

    /* 用户头像样式 */
    .user-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid rgba(255, 255, 255, 0.6);
      transition: all 0.3s ease;
      margin-right: 8px;
    }

    .user-avatar:hover {
      border-color: #fff;
      transform: scale(1.1);
    }

    .user-icon {
      font-size: 1.8rem;
      color: rgba(255, 255, 255, 0.9);
      margin-right: 8px;
      transition: all 0.3s ease;
    }

    .user-icon:hover {
      color: #fff;
      transform: scale(1.1);
    }

    /* 下拉菜单中的头像 */
    .dropdown-avatar {
      width: 64px;
      height: 64px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid var(--primary);
      margin: 0 auto;
      display: block;
    }

    .dropdown-icon {
      font-size: 3rem;
      color: var(--primary);
      display: block;
      text-align: center;
    }

    /* 下拉菜单头部样式 */
    .dropdown-header {
      padding: 1rem;
      border-bottom: 1px solid #f0f0f0;
      background-color: rgba(248, 250, 252, 0.8);
      border-radius: 0.5rem 0.5rem 0 0;
    }

    /* 头部面板 */
    .dashboard-header {
      background: var(--quantum-gradient);
      color: white;
      padding: 2.5rem 0;
      margin-bottom: 2rem;
      border-radius: 0 0 20px 20px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      position: relative;
      overflow: hidden;
    }

    .dashboard-header::before {
      content: '';
      position: absolute;
      top: -20%;
      left: -10%;
      width: 120%;
      height: 150%;
      background: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiB2aWV3Qm94PSIwIDAgMjAwIDIwMCI+CiAgPGRlZnM+CiAgICA8ZmlsdGVyIGlkPSJub2lzZSIgeD0iMCIgeT0iMCIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSI+CiAgICAgIDxmZVR1cmJ1bGVuY2UgdHlwZT0iZnJhY3RhbE5vaXNlIiBiYXNlRnJlcXVlbmN5PSIwLjY1IiBudW1PY3RhdmVzPSIzIiBzdGl0Y2hUaWxlcz0ic3RpdGNoIiByZXN1bHQ9Im5vaXNlIi8+CiAgICAgIDxmZUJsZW5kIGluPSJub2lzZSIgaW4yPSJTb3VyY2VHcmFwaGljIiBtb2RlPSJvdmVybGF5IiByZXN1bHQ9ImJsZW5kZWQiLz4KICAgIDwvZmlsdGVyPgogIDwvZGVmcz4KICA8cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJ0cmFuc3BhcmVudCIgZmlsdGVyPSJ1cmwoI25vaXNlKSIgb3BhY2l0eT0iMC4wNSIvPgo8L3N2Zz4=');
      opacity: 0.3;
      transform: rotate(10deg);
    }

    .dashboard-title {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      position: relative;
    }

    .dashboard-subtitle {
      font-size: 1.1rem;
      opacity: 0.9;
      max-width: 600px;
    }

    .dashboard-stats {
      display: flex;
      flex-wrap: wrap;
      gap: 1.5rem;
      margin-top: 1.5rem;
    }
    .dashboard-title,
    .dashboard-subtitle,
    .dashboard-stats {
        position: relative;
        z-index: 5;
        margin-left: 10px; /* 给头像留出空间 */
        max-width: 65%; /* 限制宽度以避免与头像重叠 */
    }

    .stat-item {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(10px);
      padding: 1rem 1.5rem;
      border-radius: 12px;
      text-align: center;
      min-width: 120px;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .stat-item:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
    }

    .stat-number {
      font-size: 2rem;
      font-weight: 700;
    }

    .stat-label {
      font-size: 0.9rem;
      opacity: 0.8;
    }

    /* 内容卡片 */
    .section-card {
      background: var(--card-bg);
      border-radius: 16px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
      padding: 1.5rem;
      margin-bottom: 2rem;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .section-card:hover {
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
      transform: translateY(-2px);
    }

    .section-title {
      font-size: 1.4rem;
      font-weight: 700;
      margin-bottom: 1.5rem;
      color: var(--dark);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .section-title i {
      color: var(--primary);
      font-size: 1.2rem;
    }

    /* 推荐栅格 */
    .quantum-strategy-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }

    .quantum-strategy-card {
      position: relative;
      overflow: hidden;
      padding: 1.5rem 1rem;
      text-align: center;
      border-radius: 12px;
      background: rgba(248, 250, 252, 0.8);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.03);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border: 1px solid rgba(0, 0, 0, 0.04);
    }

    .quantum-strategy-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--quantum-gradient);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .quantum-strategy-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 20px rgba(0, 0, 0, 0.06);
    }

    .quantum-strategy-card:hover::before {
      opacity: 1;
    }

    .quantum-strategy-card.active::before {
      opacity: 1;
    }

    .quantum-strategy-icon {
      font-size: 2.2rem;
      margin-bottom: 0.8rem;
      display: inline-block;
      color: var(--primary);
      transition: transform 0.3s ease;
    }

    .quantum-strategy-card:hover .quantum-strategy-icon {
      transform: scale(1.1);
    }

    /* 图标特殊颜色 */
    .icon-hybrid { color: #7c3aed; }
    .icon-cf { color: #2563eb; }
    .icon-content { color: #10b981; }
    .icon-ml { color: #ef4444; }
    .icon-popular { color: #f97316; }

    /* 推荐卡片 */
    .recommendation-cards {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 1.2rem;
      margin-top: 1.5rem;
    }

    .rec-card {
      position: relative;
      border-radius: 12px;
      overflow: hidden;
      background: #fff;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      height: 100%;
      display: flex;
      flex-direction: column;
    }

    .rec-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 20px rgba(0, 0, 0, 0.08);
    }

    .rec-img-container {
      height: 170px;
      overflow: hidden;
      position: relative;
    }

    .rec-img-container img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.5s ease;
    }

    .rec-card:hover .rec-img-container img {
      transform: scale(1.05);
    }

    .rec-content {
      padding: 1rem;
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .rec-title {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--dark);
      display: -webkit-box;
      -webkit-line-clamp: 1;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .rec-confidence {
      margin-top: auto;
    }

    .confidence-bar {
      height: 6px;
      background-color: #f1f5f9;
      border-radius: 3px;
      overflow: hidden;
    }

    .confidence-level {
      height: 100%;
      background: var(--quantum-gradient);
      border-radius: 3px;
      transition: width 1s cubic-bezier(0.19, 1, 0.22, 1);
    }

    /* 活动列表 */
    .activities-list {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .activity-item {
      background: #fff;
      border-radius: 10px;
      padding: 1rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
      transition: all 0.3s ease;
      position: relative;
      border-left: 3px solid var(--primary-light);
    }

    .activity-item:hover {
      transform: translateX(5px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    .activity-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .activity-title {
      font-weight: 600;
    }

    .activity-title a {
      color: var(--primary);
      text-decoration: none;
      transition: color 0.2s ease;
    }

    .activity-title a:hover {
      color: var(--primary-dark);
      text-decoration: underline;
    }

    .activity-date {
      font-size: 0.8rem;
      color: #64748b;
    }

    .activity-content {
      font-size: 0.95rem;
      color: #334155;
    }

    /* 快速链接 */
    .list-group-item {
      border: none;
      padding: 0.8rem 1rem;
      border-radius: 8px !important;
      margin-bottom: 0.5rem;
      background-color: rgba(248, 250, 252, 0.8);
      transition: all 0.2s ease;
    }

    .list-group-item:hover {
      background-color: rgba(240, 240, 255, 0.8);
      transform: translateX(5px);
    }

    .list-group-item i {
      color: var(--primary);
      width: 20px;
      text-align: center;
      margin-right: 10px;
    }

    /* 空状态 */
    .empty-state {
      padding: 2rem;
      text-align: center;
    }

    .empty-icon {
      font-size: 3rem;
      color: #cbd5e1;
      margin-bottom: 1rem;
    }

    .empty-state h5 {
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .empty-state p {
      color: #64748b;
      max-width: 400px;
      margin: 0 auto 1rem auto;
    }

    /* 算法说明 */
    .algo-box {
      background: #f8fafc;
      border-radius: 10px;
      padding: 1rem;
      margin-bottom: 0.5rem;
      border-left: 3px solid;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .algo-box:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.05);
    }

    .algo-title {
      display: flex;
      align-items: center;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .algo-title i {
      margin-right: 8px;
    }

    .algo-desc {
      font-size: 0.85rem;
      color: #64748b;
      margin: 0;
    }

    .border-hybrid { border-color: #7c3aed; }
    .border-cf { border-color: #2563eb; }
    .border-content { border-color: #10b981; }
    .border-ml { border-color: #ef4444; }
    .border-popular { border-color: #f97316; }

    /* 工具提示 */
    .quantum-tooltip {
      position: relative;
    }

    .quantum-tooltip::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%) translateY(-5px);
      background: rgba(15, 23, 42, 0.9);
      color: white;
      padding: 5px 10px;
      border-radius: 6px;
      font-size: 0.75rem;
      white-space: nowrap;
      pointer-events: none;
      opacity: 0;
      visibility: hidden;
      transition: all 0.2s ease;
    }

    .quantum-tooltip:hover::after {
      opacity: 1;
      visibility: visible;
      transform: translateX(-50%) translateY(-10px);
    }

    /* 仪表板标签 */
    .dashboard-tabs {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
      overflow-x: auto;
      padding-bottom: 0.5rem;
    }

    .dashboard-tab {
      padding: 0.75rem 1.25rem;
      background: #fff;
      border: none;
      border-radius: 10px;
      font-weight: 500;
      color: #64748b;
      display: flex;
      align-items: center;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
      white-space: nowrap;
    }

    .dashboard-tab:hover {
      background: #f1f5f9;
      transform: translateY(-2px);
      color: #334155;
    }

    .dashboard-tab.active {
      background: var(--quantum-gradient);
      color: white;
      box-shadow: 0 4px 12px rgba(109, 40, 217, 0.2);
    }

    /* 面板管理 */
    .dashboard-panel {
      display: none;
    }

    .dashboard-panel.active {
      display: block;
      animation: fadeIn 0.4s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* 量子态特效 */
    .quantum-particle {
      position: absolute;
      width: 4px;
      height: 4px;
      background: #8b5cf6;
      border-radius: 50%;
      pointer-events: none;
      opacity: 0.6;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    /* 加载状态 */
    .loading-container {
      text-align: center;
      padding: 2rem;
    }

    .quantum-spinner {
      display: inline-block;
      width: 50px;
      height: 50px;
      border: 3px solid rgba(109, 40, 217, 0.2);
      border-radius: 50%;
      border-top-color: #6d28d9;
      animation: quantum-spin 1s ease-in-out infinite;
    }

    @keyframes quantum-spin {
      to { transform: rotate(360deg); }
    }

    /* 响应式调整 */
    @media (max-width: 768px) {
      .user-profile-pic {
        width: 120px;
        height: 120px;
        left: 65%; /* 在移动设备上稍微右移 */
      }
        .dashboard-title,
        .dashboard-subtitle,
        .dashboard-stats {
            max-width: 60%;
          }

      .dashboard-title {
        font-size: 2rem;
      }

      .dashboard-stats {
        gap: 1rem;
        justify-content: center;
      }

      .stat-item {
        min-width: 100px;
        padding: 0.8rem;
      }

      .quantum-strategy-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .recommendation-cards {
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      }

      .user-avatar,
      /* 用户个人资料图片 - 更大更居中的版本 */
      .user-profile-pic {
      width: 150px; /* 增加尺寸 */
      height: 150px; /* 增加尺寸 */
      border-radius: 50%;
      object-fit: cover;
      border: 4px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      position: absolute;
      top: 50%; /* 垂直居中 */
      left: 50%; /* 水平居中位置 */
      transform: translate(-50%, -50%); /* 精确居中 */
      z-index: 10;
      transition: all 0.3s ease;
    }

    }

    @media (max-width: 576px) {
      .dashboard-title {
        font-size: 1.75rem;
      }

      .stat-number {
        font-size: 1.5rem;
      }

      .section-card {
        padding: 1.2rem;
      }

      .quantum-strategy-grid {
        grid-template-columns: 1fr 1fr;
      }

      .recommendation-cards {
        grid-template-columns: 1fr;
      }

      .rec-img-container {
        height: 150px;
      }

      .user-avatar,
      .user-profile-pic {
        width: 100px;
        height: 100px;
          left:75%;
      }
      .dashboard-title,
    .dashboard-subtitle,
    .dashboard-stats {
     max-width: 55%;
     }
    }

    /* 用户个人资料图片 */
    .user-profile-pic {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      object-fit: cover;
      border: 4px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      position: absolute;
      top: 10px;
      right: 30px;
      z-index: 10;
      transition: all 0.3s ease;
    }

    .user-profile-pic:hover {
      transform: translate(-50%, -50%) scale(1.05); /* 保持居中的同时实现放大效果 */
      border-color: rgba(255, 255, 255, 0.6);
    }

    /* 探索标签页样式增强 */
    .nav-pills .nav-link {
      border-radius: 8px;
      padding: 0.6rem 1.2rem;
      background-color: rgba(255, 255, 255, 0.9);
      color: var(--dark) !important;
      font-weight: 500;
      transition: all 0.3s ease;
      margin-right: 0.5rem;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    }

    .nav-pills .nav-link:hover {
      background-color: rgba(248, 250, 252, 1);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      color: var(--primary) !important;
    }

    .nav-pills .nav-link.active {
      background: var(--quantum-gradient);
      color: white !important;
      box-shadow: 0 4px 10px rgba(109, 40, 217, 0.25);
    }

    /* 参考动漫标签 */
    .reference-anime-badge {
      transition: all 0.3s ease;
      font-weight: 500;
      padding: 0.5rem 0.75rem;
    }

    .reference-anime-badge:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
    }

    /* 量子态动画 - 更平滑的界面过渡 */
    @keyframes quantumFadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .quantum-fade-in {
      animation: quantumFadeIn 0.35s ease-out forwards;
    }
  </style>
</head>
<body>
  <!-- CSRF Token -->
  {% csrf_token %}

  <!-- 导航栏 -->
  <nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container">
      <a class="navbar-brand" href="/">
        <i class="fas fa-cube"></i>量子态动漫推荐系统
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav me-auto">
          <li class="nav-item">
            <a class="nav-link {% if active_tab == 'anime_list' %}active{% endif %}" href="{% url 'anime:anime_list' %}">
              <i class="fas fa-list me-1"></i>动漫列表
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link {% if active_tab == 'anime_type' %}active{% endif %}" href="{% url 'anime:anime_type_list' %}">
              <i class="fas fa-tags me-1"></i>类型分类
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link {% if active_tab == 'recommendations' %}active{% endif %}" href="{% url 'recommendation:recommendations' %}">
              <i class="fas fa-magic me-1"></i>智能推荐
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link {% if active_tab == 'favorites' %}active{% endif %}" href="{% url 'recommendation:favorites' %}">
              <i class="fas fa-heart me-1"></i>我的收藏
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link {% if active_tab == 'dashboard' %}active{% endif %}" href="{% url 'recommendation:user_dashboard' %}">
              <i class="fas fa-chart-line me-1"></i>推荐中心
            </a>
          </li>
        </ul>
        <ul class="navbar-nav ms-auto">
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown">
              {% if user.profile.avatar %}
                <img src="{{ user.profile.avatar.url }}" alt="{{ user.username }}" class="user-avatar">
              {% else %}
                <i class="fas fa-user-circle user-icon"></i>
              {% endif %}
              <span id="username">{{ user.username }}</span>
            </a>
            <ul class="dropdown-menu dropdown-menu-end">
              <li class="dropdown-header">
                {% if user.profile.avatar %}
                  <img src="{{ user.profile.avatar.url }}" alt="{{ user.username }}" class="dropdown-avatar mb-2">
                {% else %}
                  <i class="fas fa-user-circle dropdown-icon"></i>
                {% endif %}
                <div>{{ user.username }}</div>
                <small class="text-muted">{{ user.email }}</small>
              </li>
              <li>
                <a class="dropdown-item" href="/profile/">
                  <i class="fas fa-id-card me-2"></i>个人资料
                </a>
              </li>
              <li><hr class="dropdown-divider"></li>
              <li>
                <a class="dropdown-item" href="/logout/">
                  <i class="fas fa-sign-out-alt me-2"></i>退出登录
                </a>
              </li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- 仪表板头部 -->
  <div class="dashboard-header">
    <div class="container position-relative">
      <!-- 添加用户头像在右上角 -->
      {% if user.profile.avatar %}
        <img src="{{ user.profile.avatar.url }}" alt="{{ user.username }}" class="user-profile-pic">
      {% else %}
        <i class="fas fa-user-circle user-profile-pic" style="font-size: 100px; color: rgba(255, 255, 255, 0.7);"></i>
      {% endif %}

      <h1 class="dashboard-title">我的动漫中心</h1>
      <p class="dashboard-subtitle">管理您的收藏、评分和获取基于量子算法的个性化推荐</p>

      <div class="dashboard-stats" id="userStats">
        <div class="stat-item" data-type="ratings">
          <div class="stat-number">{{ user.profile.rating_count|default:"0" }}</div>
          <div class="stat-label">评分记录</div>
        </div>
        <div class="stat-item" data-type="comments">
          <div class="stat-number">{{ user.profile.comment_count|default:"0" }}</div>
          <div class="stat-label">评论数量</div>
        </div>
        <div class="stat-item" data-type="favorites">
          <div class="stat-number">{{ user.favorites.count|default:"0" }}</div>
          <div class="stat-label">收藏动漫</div>
        </div>
        <div class="stat-item" data-type="history">
          <div class="stat-number">{{ user.browsing_history.count|default:"0" }}</div>
          <div class="stat-label">浏览历史</div>
        </div>
          <div class="stat-item" data-type="likes">
          <div class="stat-number">{{ user.anime_likes.count|default:"0" }}</div>
          <div class="stat-label">点赞记录</div>
        </div>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="row">
      <!-- 主内容区域 - 添加仪表板标签 -->
      <div class="col-12">
        <!-- 添加新的仪表板导航 -->
        <div class="dashboard-tabs mb-4">
          <button class="dashboard-tab active" data-tab-target="recommendationPanel">
            <i class="fas fa-magic me-2"></i>推荐内容
          </button>
          <button class="dashboard-tab" data-tab-target="activityPanel">
            <i class="fas fa-history me-2"></i>活动记录
          </button>
          <button class="dashboard-tab" data-tab-target="visualizationPanel">
            <i class="fas fa-chart-bar me-2"></i>数据分析
          </button>
        </div>

        <!-- 仪表板面板容器 -->
        <div class="dashboard-content">
          <!-- 推荐面板 -->
          <div class="dashboard-panel active" id="recommendationPanel">
            <div class="row">
              <div class="col-lg-8">
                <!-- 个性化推荐 -->
                <div class="section-card">
                  <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 class="section-title mb-0">
                      <i class="fas fa-magic"></i>为您推荐
                    </h2>
                    <a href="{% url 'recommendation:recommendations' %}" class="btn btn-sm btn-outline-primary rounded-pill">
                      <i class="fas fa-eye me-1"></i>查看全部推荐
                    </a>
                  </div>

                  <!-- 推荐算法快速选择 -->
                  <div class="quantum-strategy-grid">
                    <a href="javascript:void(0)" class="quantum-strategy-card quantum-tooltip strategy-selector active" data-strategy="hybrid" data-tooltip="基于混合算法推荐">
                      <i class="fas fa-magic quantum-strategy-icon icon-hybrid"></i>
                      <span>混合推荐</span>
                    </a>
                    <a href="javascript:void(0)" class="quantum-strategy-card quantum-tooltip strategy-selector" data-strategy="cf" data-tooltip="基于相似用户偏好">
                      <i class="fas fa-users quantum-strategy-icon icon-cf"></i>
                      <span>协同过滤</span>
                    </a>
                    <a href="javascript:void(0)" class="quantum-strategy-card quantum-tooltip strategy-selector" data-strategy="content" data-tooltip="基于动漫内容特征">
                      <i class="fas fa-tags quantum-strategy-icon icon-content"></i>
                      <span>基于内容</span>
                    </a>
                    <a href="javascript:void(0)" class="quantum-strategy-card quantum-tooltip strategy-selector" data-strategy="ml" data-tooltip="使用GBDT机器学习模型">
                      <i class="fas fa-brain quantum-strategy-icon icon-ml"></i>
                      <span>基于GBDT</span>
                    </a>
                    <a href="javascript:void(0)" class="quantum-strategy-card quantum-tooltip strategy-selector" data-strategy="popular" data-tooltip="热门动漫推荐">
                      <i class="fas fa-fire quantum-strategy-icon icon-popular"></i>
                      <span>热门推荐</span>
                    </a>
                  </div>

                  <!-- 推荐列表 -->
                  <div class="recommendation-cards" id="recommendationContainer">
                    <!-- 加载状态 -->
                    <div class="loading-container">
                      <div class="quantum-spinner"></div>
                      <p class="mt-3">量子态计算中...</p>
                    </div>
                  </div>

                  <!-- 个性化推荐扩展区域 - 探索更多模块 -->
                  <div class="section-card mt-4">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                      <h3 class="section-title mb-0">
                        <i class="fas fa-compass text-primary"></i> 探索更多
                      </h3>
                      <a href="{% url 'anime:anime_list' %}" class="btn btn-sm btn-outline-primary rounded-pill">
                        查看全部
                      </a>
                    </div>

                    <!-- 内容分类标签 -->
                    <ul class="nav nav-pills mb-3" id="explorationTabs" role="tablist">
                      <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="seasonal-tab" data-bs-toggle="pill" data-bs-target="#seasonal" type="button" role="tab">
                          <i class="fas fa-calendar-alt me-1"></i>本季新番
                        </button>
                      </li>
                      <li class="nav-item" role="presentation">
                        <button class="nav-link" id="similar-tab" data-bs-toggle="pill" data-bs-target="#similar" type="button" role="tab">
                          <i class="fas fa-puzzle-piece me-1"></i>相似推荐
                        </button>
                      </li>
                      <li class="nav-item" role="presentation">
                        <button class="nav-link" id="classic-tab" data-bs-toggle="pill" data-bs-target="#classic" type="button" role="tab">
                          <i class="fas fa-trophy me-1"></i>经典必看
                        </button>
                      </li>
                    </ul>

                    <!-- 内容区域 -->
                    <div class="tab-content" id="explorationTabContent">
                      <!-- 本季新番 -->
                      <div class="tab-pane fade show active" id="seasonal" role="tabpanel">
                        <!-- 由ExplorationController动态填充 -->
                        <div class="text-center py-5">
                          <div class="quantum-spinner"></div>
                          <p class="mt-3">正在获取本季新番...</p>
                        </div>
                      </div>

                      <!-- 相似推荐 -->
                      <div class="tab-pane fade" id="similar" role="tabpanel">
                        <!-- 由ExplorationController动态填充 -->
                        <div class="text-center py-5">
                          <div class="quantum-spinner"></div>
                          <p class="mt-3">正在分析您的喜好...</p>
                        </div>
                      </div>

                      <!-- 经典必看 -->
                      <div class="tab-pane fade" id="classic" role="tabpanel">
                        <!-- 由ExplorationController动态填充 -->
                        <div class="text-center py-5">
                          <div class="quantum-spinner"></div>
                          <p class="mt-3">正在收集经典推荐...</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-lg-4">
                <!-- 算法说明 -->
                <div class="section-card">
                  <h2 class="section-title">
                    <i class="fas fa-brain"></i>量子推荐算法
                  </h2>

                  <div class="p-2">
                    <div class="algo-box border-hybrid mb-3">
                      <div class="algo-title">
                        <i class="fas fa-magic me-2 icon-hybrid"></i>混合推荐
                      </div>
                      <p class="algo-desc">量子态算法融合，使用高维概率分布模型，结合多种推荐策略动态权重</p>
                    </div>

                    <div class="algo-box border-cf mb-3">
                      <div class="algo-title">
                        <i class="fas fa-users me-2 icon-cf"></i>协同过滤
                      </div>
                      <p class="algo-desc">基于用户行为相似性的矩阵分解算法，采用余弦相似度进行降维映射</p>
                    </div>

                    <div class="algo-box border-content mb-3">
                      <div class="algo-title">
                        <i class="fas fa-tags me-2 icon-content"></i>基于内容
                      </div>
                      <p class="algo-desc">使用特征向量计算内容相似度，分析动漫的语义空间几何关系</p>
                    </div>

                    <div class="algo-box border-ml mb-3">
                      <div class="algo-title">
                        <i class="fas fa-brain me-2 icon-ml"></i>基于GBDT
                      </div>
                      <p class="algo-desc">梯度提升决策树深度学习模型，从特征空间中提取非线性模式</p>
                    </div>

                    <div class="algo-box border-popular mb-3">
                      <div class="algo-title">
                        <i class="fas fa-fire me-2 icon-popular"></i>热门推荐
                      </div>
                      <p class="algo-desc">基于集体智能的热点检测算法，使用时间衰减模型优化推荐</p>
                    </div>
                  </div>
                </div>

                <!-- 快速链接 -->
                <div class="section-card">
                  <h2 class="section-title">
                    <i class="fas fa-link"></i>快速链接
                  </h2>

                  <div class="list-group">
                    <a href="{% url 'anime:anime_list' %}" class="list-group-item list-group-item-action">
                      <i class="fas fa-list"></i>浏览所有动漫
                    </a>
                    <a href="{% url 'anime:anime_type_list' %}" class="list-group-item list-group-item-action">
                      <i class="fas fa-tags"></i>动漫类型列表
                    </a>
                    <a href="{% url 'recommendation:recommendations' %}" class="list-group-item list-group-item-action">
                      <i class="fas fa-magic"></i>个性化推荐
                    </a>
                    <a href="/profile/" class="list-group-item list-group-item-action">
                      <i class="fas fa-user-cog"></i>管理个人资料
                    </a>
                    <a href="{% url 'recommendation:favorites' %}" class="list-group-item list-group-item-action">
                      <i class="fas fa-heart"></i>我的收藏
                    </a>
                    <a href="{% url 'recommendation:user_ratings' %}" class="list-group-item list-group-item-action">
                      <i class="fas fa-star"></i>我的评分
                    </a>
                    <a href="{% url 'recommendation:browsing_history' %}" class="list-group-item list-group-item-action">
                      <i class="fas fa-history"></i>浏览历史
                    </a>
                    <a href="{% url 'recommendation:user_comments' %}" class="list-group-item list-group-item-action">
                      <i class="fas fa-comments"></i>我的评论
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- 活动记录面板 -->
          <div class="dashboard-panel" id="activityPanel">
            <div class="row">
              <div class="col-lg-6">
                <!-- 最近评分 -->
                <div class="section-card">
                  <h2 class="section-title">
                    <i class="fas fa-star"></i>
                      <a href="{% url 'recommendation:user_ratings' %}" style="text-decoration: none; color: inherit;">
                      最近评分
                          <small class="ms-2 fs-6">
                              <i class="fas fa-external-link-alt"></i>
                          </small>
                      </a>
                  </h2>
                  <div id="ratingsContainer">
                    <!-- 数据加载中 -->
                    <div class="loading-container">
                      <div class="quantum-spinner"></div>
                      <p class="mt-3">加载评分记录中...</p>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-lg-6">
                <!-- 最近评论 -->
                <div class="section-card">
                  <h2 class="section-title">
                    <i class="fas fa-comment"></i>
                    <a href="{% url 'recommendation:user_comments' %}" style="text-decoration: none; color: inherit;">
                      最近评论
                      <small class="ms-2 fs-6">
                        <i class="fas fa-external-link-alt"></i>
                      </small>
                    </a>
                  </h2>
                  <div id="commentsContainer">
                    <!-- 数据加载中 -->
                    <div class="loading-container">
                      <div class="quantum-spinner"></div>
                      <p class="mt-3">加载评论记录中...</p>
                    </div>
                  </div>
                </div>
              </div>

                <div class="col-lg-6">
                    <!-- 最近点赞 -->
                    <div class="section-card">
                      <h2 class="section-title">
                        <i class="fas fa-thumbs-up"></i>
                        <a href="{% url 'recommendation:user_likes' %}" style="text-decoration: none; color: inherit;">
                          最近点赞
                          <small class="ms-2 fs-6">
                            <i class="fas fa-external-link-alt"></i>
                          </small>
                        </a>
                      </h2>
                      <div id="likesContainer">
                        <!-- 数据加载中 -->
                        <div class="loading-container">
                          <div class="quantum-spinner"></div>
                          <p class="mt-3">加载点赞记录中...</p>
                        </div>
                      </div>
                    </div>
                </div>

            </div>
          </div>

          <!-- 数据可视化面板 -->
          <div class="dashboard-panel" id="visualizationPanel">
            {% include 'recommendation/partials/visualization_components.html' %}
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- JavaScript 架构层 -->
  <!-- 基础依赖 -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="/static/recommendation/js/visualization.js"></script>
  <!-- 核心架构组件 -->
  <script src="/static/recommendation/js/dashboard.js"></script>
  <script src="/static/recommendation/js/exploration-controller.js"></script>


  <!-- 初始数据加载 -->
  <script>
    // 初始数据注入 - 量子内存态服务
    const initialRatings = {{ user_ratings|safe }};
    const initialComments = {{ user_comments|safe }};
    const initialLikes = {{ user_likes|safe }};  // 添加点赞数据

    // 路由调试开关
    window.DEBUG_ROUTER = false;

    // 全局URL路由映射表 - 量子路径导航系统
    window.URLS = {
      // 基础路由
      animeList: "{% url 'anime:anime_list' %}",
      recommendations: "{% url 'recommendation:recommendations' %}",
      browsingHistory: "{% url 'recommendation:browsing_history' %}",
      favorites: "{% url 'recommendation:favorites' %}",
      userComments: "{% url 'recommendation:user_comments' %}",
        userLikes: "{% url 'recommendation:user_likes' %}",  // 添加点赞页面URL

      // 动态路由基地址 - 用于构建详情页URL
      animeDetail: "/anime/", // 确保这与URL配置一致

      // 元数据
      version: "2.3.7-quantum",
      buildTimestamp: "{{ build_timestamp|default:'2025-03-29' }}"
    };
  </script>

  <!-- 仪表板标签切换控制器 -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // 获取所有标签按钮和面板
      const tabButtons = document.querySelectorAll('.dashboard-tab');
      const panels = document.querySelectorAll('.dashboard-panel');

      // 为每个按钮添加点击事件
      tabButtons.forEach(button => {
        button.addEventListener('click', function() {
          // 获取目标面板ID
          const targetId = this.dataset.tabTarget;

          // 移除所有活动状态
          tabButtons.forEach(btn => btn.classList.remove('active'));
          panels.forEach(panel => panel.classList.remove('active'));

          // 设置当前按钮和面板为活动状态
          this.classList.add('active');
          document.getElementById(targetId).classList.add('active');
          // 如果激活了可视化面板，则初始化可视化
          if (targetId === 'visualizationPanel' && window.vizEngine) {
            console.log('[QUANTUM] 初始化可视化...');
            window.vizEngine.initializeCharts();
          }
          // 触发窗口调整事件，让图表重新绘制
          window.dispatchEvent(new Event('resize'));
        });
      });
    });
  </script>

  <!-- 量子动画和粒子效果 -->
  <script>
    // 创建并初始化仪表盘控制器 - 量子实例化器
    document.addEventListener('DOMContentLoaded', function() {
      console.log('[QUANTUM-CORE] 初始化量子态仪表盘 v' + window.URLS.version);

      // 主控制器实例化
      window.dashboardController = new DashboardController();
      dashboardController.initDashboard();

      // 探索控制器实例化
      window.explorationController = new ExplorationController(dashboardController);
      explorationController.init();

      // 创建粒子效果
      createQuantumParticles();

      console.log('[QUANTUM-CORE] 量子态仪表盘初始化完成 | ' + new Date().toISOString());
    });

    // 量子粒子效果函数 - 视觉态坍缩仿真
    function createQuantumParticles() {
      const container = document.querySelector('.dashboard-header');
      if (!container) return;

      const numberOfParticles = 20;

      for (let i = 0; i < numberOfParticles; i++) {
        const particle = document.createElement('div');
        particle.classList.add('quantum-particle');

        // 随机位置 - 空间分布函数
        const xPos = Math.random() * 100;
        const yPos = Math.random() * 100;

        particle.style.left = `${xPos}%`;
        particle.style.top = `${yPos}%`;

        // 随机大小 - 量子粒径映射
        const size = Math.random() * 5 + 2;
        particle.style.width = `${size}px`;
        particle.style.height = `${size}px`;

        // 随机颜色 - 光谱态编码
        const hue = Math.random() * 60 + 240; // 蓝紫色调
        particle.style.backgroundColor = `hsl(${hue}, 80%, 70%)`;

        // 随机动画 - 时间态映射
        const duration = Math.random() * 10 + 5;
        const delay = Math.random() * 5;

        particle.style.animation = `float ${duration}s ease-in-out ${delay}s infinite`;

        // 随机透明度 - 概率密度函数
        particle.style.opacity = Math.random() * 0.5 + 0.3;

        container.appendChild(particle);
      }
    }
  </script>
{% include 'partials/footer.html' %}
</body>
</html>