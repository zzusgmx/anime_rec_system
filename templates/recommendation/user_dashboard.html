<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>量子态动漫推荐系统 - 用户中心</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Font Awesome 图标库 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

  <style>
    :root {
      --primary: #6d28d9;
      --primary-dark: #5b21b6;
      --primary-light: #8b5cf6;
      --secondary: #10b981;
      --secondary-dark: #059669;
      --dark: #1e293b;
      --light: #f8fafc;
      --card-bg: #ffffff;
      --accent: #f97316;
      --quantum-gradient: linear-gradient(135deg, #6d28d9, #8b5cf6, #10b981);
    }

    /* 全局样式 */
    body {
      font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', sans-serif;
      background: #f0f2f5;
      color: var(--dark);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* 导航栏 */
    .navbar {
      background: var(--quantum-gradient);
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      padding: 0.75rem 1.5rem;
    }

    .navbar-brand {
      color: white;
      font-weight: 700;
      font-size: 1.4rem;
      display: flex;
      align-items: center;
    }

    .navbar-brand i {
      margin-right: 10px;
      font-size: 1.5rem;
    }

    .nav-link {
      color: rgba(255, 255, 255, 0.85) !important;
      font-weight: 500;
      padding: 0.5rem 1rem;
      position: relative;
      transition: all 0.3s ease;
    }

    .nav-link:hover {
      color: white !important;
    }

    .nav-link.active {
      color: white !important;
    }

    .nav-link.active::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 1rem;
      right: 1rem;
      height: 3px;
      background-color: var(--accent);
      border-radius: 3px 3px 0 0;
    }

    /* 用户头像样式 */
    .user-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid rgba(255, 255, 255, 0.6);
      transition: all 0.3s ease;
      margin-right: 8px;
    }

    .user-avatar:hover {
      border-color: #fff;
      transform: scale(1.1);
    }

    .user-icon {
      font-size: 1.8rem;
      color: rgba(255, 255, 255, 0.9);
      margin-right: 8px;
      transition: all 0.3s ease;
    }

    .user-icon:hover {
      color: #fff;
      transform: scale(1.1);
    }

    /* 下拉菜单中的头像 */
    .dropdown-avatar {
      width: 64px;
      height: 64px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid var(--primary);
      margin: 0 auto;
      display: block;
    }

    .dropdown-icon {
      font-size: 3rem;
      color: var(--primary);
      display: block;
      text-align: center;
    }

    /* 下拉菜单头部样式 */
    .dropdown-header {
      padding: 1rem;
      border-bottom: 1px solid #f0f0f0;
      background-color: rgba(248, 250, 252, 0.8);
      border-radius: 0.5rem 0.5rem 0 0;
    }

    /* 头部面板 */
    .dashboard-header {
      background: var(--quantum-gradient);
      color: white;
      padding: 2.5rem 0;
      margin-bottom: 2rem;
      border-radius: 0 0 20px 20px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      position: relative;
      overflow: hidden;
    }

    .dashboard-header::before {
      content: '';
      position: absolute;
      top: -20%;
      left: -10%;
      width: 120%;
      height: 150%;
      background: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiB2aWV3Qm94PSIwIDAgMjAwIDIwMCI+CiAgPGRlZnM+CiAgICA8ZmlsdGVyIGlkPSJub2lzZSIgeD0iMCIgeT0iMCIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSI+CiAgICAgIDxmZVR1cmJ1bGVuY2UgdHlwZT0iZnJhY3RhbE5vaXNlIiBiYXNlRnJlcXVlbmN5PSIwLjY1IiBudW1PY3RhdmVzPSIzIiBzdGl0Y2hUaWxlcz0ic3RpdGNoIiByZXN1bHQ9Im5vaXNlIi8+CiAgICAgIDxmZUJsZW5kIGluPSJub2lzZSIgaW4yPSJTb3VyY2VHcmFwaGljIiBtb2RlPSJvdmVybGF5IiByZXN1bHQ9ImJsZW5kZWQiLz4KICAgIDwvZmlsdGVyPgogIDwvZGVmcz4KICA8cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJ0cmFuc3BhcmVudCIgZmlsdGVyPSJ1cmwoI25vaXNlKSIgb3BhY2l0eT0iMC4wNSIvPgo8L3N2Zz4=');
      opacity: 0.3;
      transform: rotate(10deg);
    }

    .dashboard-title {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      position: relative;
    }

    .dashboard-subtitle {
      font-size: 1.1rem;
      opacity: 0.9;
      max-width: 600px;
    }

    .dashboard-stats {
      display: flex;
      flex-wrap: wrap;
      gap: 1.5rem;
      margin-top: 1.5rem;
    }
    .dashboard-title,
    .dashboard-subtitle,
    .dashboard-stats {
        position: relative;
        z-index: 5;
        margin-left: 10px; /* 给头像留出空间 */
        max-width: 65%; /* 限制宽度以避免与头像重叠 */
    }

    .stat-item {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(10px);
      padding: 1rem 1.5rem;
      border-radius: 12px;
      text-align: center;
      min-width: 120px;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .stat-item:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
    }

    .stat-number {
      font-size: 2rem;
      font-weight: 700;
    }

    .stat-label {
      font-size: 0.9rem;
      opacity: 0.8;
    }

    /* 内容卡片 */
    .section-card {
      background: var(--card-bg);
      border-radius: 16px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
      padding: 1.5rem;
      margin-bottom: 2rem;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .section-card:hover {
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
      transform: translateY(-2px);
    }

    .section-title {
      font-size: 1.4rem;
      font-weight: 700;
      margin-bottom: 1.5rem;
      color: var(--dark);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .section-title i {
      color: var(--primary);
      font-size: 1.2rem;
    }

    /* 推荐栅格 */
    .quantum-strategy-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }

    .quantum-strategy-card {
      position: relative;
      overflow: hidden;
      padding: 1.5rem 1rem;
      text-align: center;
      border-radius: 12px;
      background: rgba(248, 250, 252, 0.8);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.03);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border: 1px solid rgba(0, 0, 0, 0.04);
    }

    .quantum-strategy-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--quantum-gradient);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .quantum-strategy-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 20px rgba(0, 0, 0, 0.06);
    }

    .quantum-strategy-card:hover::before {
      opacity: 1;
    }

    .quantum-strategy-icon {
      font-size: 2.2rem;
      margin-bottom: 0.8rem;
      display: inline-block;
      color: var(--primary);
      transition: transform 0.3s ease;
    }

    .quantum-strategy-card:hover .quantum-strategy-icon {
      transform: scale(1.1);
    }

    /* 图标特殊颜色 */
    .icon-hybrid { color: #7c3aed; }
    .icon-cf { color: #2563eb; }
    .icon-content { color: #10b981; }
    .icon-ml { color: #ef4444; }
    .icon-popular { color: #f97316; }

    /* 推荐卡片 */
    .recommendation-cards {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 1.2rem;
      margin-top: 1.5rem;
    }

    .rec-card {
      position: relative;
      border-radius: 12px;
      overflow: hidden;
      background: #fff;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      height: 100%;
      display: flex;
      flex-direction: column;
    }

    .rec-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 20px rgba(0, 0, 0, 0.08);
    }

    .rec-img-container {
      height: 170px;
      overflow: hidden;
      position: relative;
    }

    .rec-img-container img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.5s ease;
    }

    .rec-card:hover .rec-img-container img {
      transform: scale(1.05);
    }

    .rec-content {
      padding: 1rem;
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .rec-title {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--dark);
      display: -webkit-box;
      -webkit-line-clamp: 1;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .rec-confidence {
      margin-top: auto;
    }

    .confidence-bar {
      height: 6px;
      background-color: #f1f5f9;
      border-radius: 3px;
      overflow: hidden;
    }

    .confidence-level {
      height: 100%;
      background: var(--quantum-gradient);
      border-radius: 3px;
      transition: width 1s cubic-bezier(0.19, 1, 0.22, 1);
    }

    /* 活动列表 */
    .activities-list {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .activity-item {
      background: #fff;
      border-radius: 10px;
      padding: 1rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
      transition: all 0.3s ease;
      position: relative;
      border-left: 3px solid var(--primary-light);
    }

    .activity-item:hover {
      transform: translateX(5px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    .activity-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .activity-title {
      font-weight: 600;
    }

    .activity-title a {
      color: var(--primary);
      text-decoration: none;
      transition: color 0.2s ease;
    }

    .activity-title a:hover {
      color: var(--primary-dark);
      text-decoration: underline;
    }

    .activity-date {
      font-size: 0.8rem;
      color: #64748b;
    }

    .activity-content {
      font-size: 0.95rem;
      color: #334155;
    }

    /* 快速链接 */
    .list-group-item {
      border: none;
      padding: 0.8rem 1rem;
      border-radius: 8px !important;
      margin-bottom: 0.5rem;
      background-color: rgba(248, 250, 252, 0.8);
      transition: all 0.2s ease;
    }

    .list-group-item:hover {
      background-color: rgba(240, 240, 255, 0.8);
      transform: translateX(5px);
    }

    .list-group-item i {
      color: var(--primary);
      width: 20px;
      text-align: center;
      margin-right: 10px;
    }

    /* 空状态 */
    .empty-state {
      padding: 2rem;
      text-align: center;
    }

    .empty-icon {
      font-size: 3rem;
      color: #cbd5e1;
      margin-bottom: 1rem;
    }

    .empty-state h5 {
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .empty-state p {
      color: #64748b;
      max-width: 400px;
      margin: 0 auto 1rem auto;
    }

    /* 算法说明 */
    .algo-box {
      background: #f8fafc;
      border-radius: 10px;
      padding: 1rem;
      margin-bottom: 0.5rem;
      border-left: 3px solid;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .algo-box:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.05);
    }

    .algo-title {
      display: flex;
      align-items: center;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .algo-title i {
      margin-right: 8px;
    }

    .algo-desc {
      font-size: 0.85rem;
      color: #64748b;
      margin: 0;
    }

    .border-hybrid { border-color: #7c3aed; }
    .border-cf { border-color: #2563eb; }
    .border-content { border-color: #10b981; }
    .border-ml { border-color: #ef4444; }
    .border-popular { border-color: #f97316; }

    /* 工具提示 */
    .quantum-tooltip {
      position: relative;
    }

    .quantum-tooltip::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%) translateY(-5px);
      background: rgba(15, 23, 42, 0.9);
      color: white;
      padding: 5px 10px;
      border-radius: 6px;
      font-size: 0.75rem;
      white-space: nowrap;
      pointer-events: none;
      opacity: 0;
      visibility: hidden;
      transition: all 0.2s ease;
    }

    .quantum-tooltip:hover::after {
      opacity: 1;
      visibility: visible;
      transform: translateX(-50%) translateY(-10px);
    }

    /* 量子态特效 */
    .quantum-particle {
      position: absolute;
      width: 4px;
      height: 4px;
      background: #8b5cf6;
      border-radius: 50%;
      pointer-events: none;
      opacity: 0.6;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    /* 加载状态 */
    .loading-container {
      text-align: center;
      padding: 2rem;
    }

    .quantum-spinner {
      display: inline-block;
      width: 50px;
      height: 50px;
      border: 3px solid rgba(109, 40, 217, 0.2);
      border-radius: 50%;
      border-top-color: #6d28d9;
      animation: quantum-spin 1s ease-in-out infinite;
    }

    @keyframes quantum-spin {
      to { transform: rotate(360deg); }
    }

    /* 响应式调整 */
    @media (max-width: 768px) {
      .user-profile-pic {
        width: 120px;
        height: 120px;
        left: 65%; /* 在移动设备上稍微右移 */
      }
        .dashboard-title,
        .dashboard-subtitle,
        .dashboard-stats {
            max-width: 60%;
          }

      .dashboard-title {
        font-size: 2rem;
      }

      .dashboard-stats {
        gap: 1rem;
        justify-content: center;
      }

      .stat-item {
        min-width: 100px;
        padding: 0.8rem;
      }

      .quantum-strategy-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .recommendation-cards {
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      }

      .user-avatar,
      /* 用户个人资料图片 - 更大更居中的版本 */
      .user-profile-pic {
      width: 150px; /* 增加尺寸 */
      height: 150px; /* 增加尺寸 */
      border-radius: 50%;
      object-fit: cover;
      border: 4px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      position: absolute;
      top: 50%; /* 垂直居中 */
      left: 50%; /* 水平居中位置 */
      transform: translate(-50%, -50%); /* 精确居中 */
      z-index: 10;
      transition: all 0.3s ease;
    }

    }

    @media (max-width: 576px) {
      .dashboard-title {
        font-size: 1.75rem;
      }

      .stat-number {
        font-size: 1.5rem;
      }

      .section-card {
        padding: 1.2rem;
      }

      .quantum-strategy-grid {
        grid-template-columns: 1fr 1fr;
      }

      .recommendation-cards {
        grid-template-columns: 1fr;
      }

      .rec-img-container {
        height: 150px;
      }

      .user-avatar,
      .user-profile-pic {
        width: 100px;
        height: 100px;
          left:75%;
      }
      .dashboard-title,
    .dashboard-subtitle,
    .dashboard-stats {
     max-width: 55%;
     }
    }

    /* 用户个人资料图片 */
    .user-profile-pic {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      object-fit: cover;
      border: 4px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      position: absolute;
      top: 10px;
      right: 30px;
      z-index: 10;
      transition: all 0.3s ease;
    }

    .user-profile-pic:hover {
      transform: translate(-50%, -50%) scale(1.05); /* 保持居中的同时实现放大效果 */
      border-color: rgba(255, 255, 255, 0.6);
    }
  </style>
</head>
<body>
  <!-- 导航栏 -->
  <nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container">
      <a class="navbar-brand" href="/">
        <i class="fas fa-cube"></i>量子态动漫推荐系统
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav me-auto">
          <li class="nav-item">
            <a class="nav-link" href="/anime/list/">
              <i class="fas fa-list me-1"></i>动漫列表
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/anime/types/">
              <i class="fas fa-tags me-1"></i>类型分类
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/recommendations/">
              <i class="fas fa-magic me-1"></i>智能推荐
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/favorites/">
              <i class="fas fa-heart me-1"></i>我的收藏
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="/recommendations/dashboard/">
              <i class="fas fa-chart-line me-1"></i>推荐中心
            </a>
          </li>
        </ul>
        <ul class="navbar-nav ms-auto">
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown">
              {% if user.profile.avatar %}
                <img src="{{ user.profile.avatar.url }}" alt="{{ user.username }}" class="user-avatar">
              {% else %}
                <i class="fas fa-user-circle user-icon"></i>
              {% endif %}
              <span id="username">{{ user.username }}</span>
            </a>
            <ul class="dropdown-menu dropdown-menu-end">
              <li class="dropdown-header">
                {% if user.profile.avatar %}
                  <img src="{{ user.profile.avatar.url }}" alt="{{ user.username }}" class="dropdown-avatar mb-2">
                {% else %}
                  <i class="fas fa-user-circle dropdown-icon"></i>
                {% endif %}
                <div>{{ user.username }}</div>
                <small class="text-muted">{{ user.email }}</small>
              </li>
              <li>
                <a class="dropdown-item" href="/profile/">
                  <i class="fas fa-id-card me-2"></i>个人资料
                </a>
              </li>
              <li><hr class="dropdown-divider"></li>
              <li>
                <a class="dropdown-item" href="/logout/">
                  <i class="fas fa-sign-out-alt me-2"></i>退出登录
                </a>
              </li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- 仪表板头部 -->
  <div class="dashboard-header">
    <div class="container position-relative">
      <!-- 添加用户头像在右上角 -->


      <h1 class="dashboard-title">我的动漫中心</h1>
      <p class="dashboard-subtitle">管理您的收藏、评分和获取基于量子算法的个性化推荐</p>

      <div class="dashboard-stats" id="userStats">
        <div class="stat-item" data-type="ratings">
          <div class="stat-number">{{ user.profile.rating_count|default:"0" }}</div>
          <div class="stat-label">评分记录</div>
        </div>
        <div class="stat-item" data-type="comments">
          <div class="stat-number">{{ user.profile.comment_count|default:"0" }}</div>
          <div class="stat-label">评论数量</div>
        </div>
        <div class="stat-item" data-type="favorites">
          <div class="stat-number">{{ user.favorites.count|default:"0" }}</div>
          <div class="stat-label">收藏动漫</div>
        </div>
        <div class="stat-item" data-type="history">
          <div class="stat-number">{{ user.browsing_history.count|default:"0" }}</div>
          <div class="stat-label">浏览历史</div>
        </div>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="row">
      <!-- 主内容区域 -->
      <div class="col-lg-8">
        <!-- 个性化推荐 -->
        <div class="section-card">
          <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="section-title mb-0">
              <i class="fas fa-magic"></i>为您推荐
            </h2>
            <a href="/recommendations/" class="btn btn-sm btn-outline-primary rounded-pill">
              <i class="fas fa-eye me-1"></i>查看全部推荐
            </a>
          </div>

          <!-- 推荐算法快速选择 -->
          <div class="quantum-strategy-grid">
            <a href="javascript:loadRecommendations('hybrid')" class="quantum-strategy-card quantum-tooltip strategy-selector active" data-strategy="hybrid" data-tooltip="基于混合算法推荐">
              <i class="fas fa-magic quantum-strategy-icon icon-hybrid"></i>
              <span>混合推荐</span>
            </a>
            <a href="javascript:loadRecommendations('cf')" class="quantum-strategy-card quantum-tooltip strategy-selector" data-strategy="cf" data-tooltip="基于相似用户偏好">
              <i class="fas fa-users quantum-strategy-icon icon-cf"></i>
              <span>协同过滤</span>
            </a>
            <a href="javascript:loadRecommendations('content')" class="quantum-strategy-card quantum-tooltip strategy-selector" data-strategy="content" data-tooltip="基于动漫内容特征">
              <i class="fas fa-tags quantum-strategy-icon icon-content"></i>
              <span>基于内容</span>
            </a>
            <a href="javascript:loadRecommendations('ml')" class="quantum-strategy-card quantum-tooltip strategy-selector" data-strategy="ml" data-tooltip="使用GBDT机器学习模型">
              <i class="fas fa-brain quantum-strategy-icon icon-ml"></i>
              <span>基于GBDT</span>
            </a>
            <a href="javascript:loadRecommendations('popular')" class="quantum-strategy-card quantum-tooltip strategy-selector" data-strategy="popular" data-tooltip="热门动漫推荐">
              <i class="fas fa-fire quantum-strategy-icon icon-popular"></i>
              <span>热门推荐</span>
            </a>
          </div>

          <!-- 推荐列表 -->
          <div class="recommendation-cards" id="recommendationContainer">
            <!-- 加载状态 -->
            <div class="loading-container">
              <div class="quantum-spinner"></div>
              <p class="mt-3">量子态计算中...</p>
            </div>
          </div>
        </div>

        <!-- 最近评分 -->
        <div class="section-card">
          <h2 class="section-title">
            <i class="fas fa-star"></i>最近评分
          </h2>

          <div id="ratingsContainer">
            <!-- 数据加载中 -->
            <div class="loading-container">
              <div class="quantum-spinner"></div>
              <p class="mt-3">加载评分记录中...</p>
            </div>
          </div>
        </div>
      </div>

      <!-- 侧边栏 -->
      <div class="col-lg-4">
        <!-- 最近评论 -->
        <div class="section-card">
          <h2 class="section-title">
            <i class="fas fa-comment"></i>最近评论
          </h2>

          <div id="commentsContainer">
            <!-- 数据加载中 -->
            <div class="loading-container">
              <div class="quantum-spinner"></div>
              <p class="mt-3">加载评论记录中...</p>
            </div>
          </div>
        </div>

        <!-- 快速链接 -->
        <div class="section-card">
          <h2 class="section-title">
            <i class="fas fa-link"></i>快速链接
          </h2>

          <div class="list-group">
            <a href="/anime/list/" class="list-group-item list-group-item-action">
              <i class="fas fa-list"></i>浏览所有动漫
            </a>
            <a href="/anime/types/" class="list-group-item list-group-item-action">
              <i class="fas fa-tags"></i>动漫类型列表
            </a>
            <a href="/recommendations/" class="list-group-item list-group-item-action">
              <i class="fas fa-magic"></i>个性化推荐
            </a>
            <a href="/profile/" class="list-group-item list-group-item-action">
              <i class="fas fa-user-cog"></i>管理个人资料
            </a>
            <a href="/favorites/" class="list-group-item list-group-item-action">
              <i class="fas fa-heart"></i>我的收藏
            </a>
          </div>
        </div>

        <!-- 推荐算法说明 -->
        <div class="section-card">
          <h2 class="section-title">
            <i class="fas fa-brain"></i>量子推荐算法
          </h2>

          <div class="p-2">
            <div class="algo-box border-hybrid mb-3">
              <div class="algo-title">
                <i class="fas fa-magic me-2 icon-hybrid"></i>混合推荐
              </div>
              <p class="algo-desc">量子态算法融合，使用高维概率分布模型，结合多种推荐策略动态权重</p>
            </div>

            <div class="algo-box border-cf mb-3">
              <div class="algo-title">
                <i class="fas fa-users me-2 icon-cf"></i>协同过滤
              </div>
              <p class="algo-desc">基于用户行为相似性的矩阵分解算法，采用余弦相似度进行降维映射</p>
            </div>

            <div class="algo-box border-content mb-3">
              <div class="algo-title">
                <i class="fas fa-tags me-2 icon-content"></i>基于内容
              </div>
              <p class="algo-desc">使用特征向量计算内容相似度，分析动漫的语义空间几何关系</p>
            </div>

            <div class="algo-box border-ml mb-3">
              <div class="algo-title">
                <i class="fas fa-brain me-2 icon-ml"></i>基于GBDT
              </div>
              <p class="algo-desc">梯度提升决策树深度学习模型，从特征空间中提取非线性模式</p>
            </div>

            <div class="algo-box border-popular mb-3">
              <div class="algo-title">
                <i class="fas fa-fire me-2 icon-popular"></i>热门推荐
              </div>
              <p class="algo-desc">基于集体智能的热点检测算法，使用时间衰减模型优化推荐</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- JavaScript -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <script>
    // 全局状态管理
    const state = {
      currentStrategy: 'hybrid',
      userData: null,
      recommendations: {},
      ratings: [],
      comments: []
    };

    // DOM就绪后执行初始化
    document.addEventListener('DOMContentLoaded', function() {
      // 初始化粒子效果
      createParticles();

      // 设置当前导航链接
      setActiveNavLink();

      // 加载用户数据
      loadUserData();

      // 初始化推荐
      loadRecommendations('hybrid');

      // 加载评分和评论数据
      loadUserActivities();

      // 策略选择器事件委托
      document.querySelector('.quantum-strategy-grid').addEventListener('click', function(event) {
        const selector = event.target.closest('.strategy-selector');
        if (selector) {
          const strategy = selector.dataset.strategy;
          setActiveStrategy(strategy);
          loadRecommendations(strategy);
        }
      });
    });

    // 创建量子态粒子效果
    function createParticles() {
      const container = document.querySelector('.dashboard-header');
      const numberOfParticles = 20;

      for (let i = 0; i < numberOfParticles; i++) {
        const particle = document.createElement('div');
        particle.classList.add('quantum-particle');

        // 随机位置
        const xPos = Math.random() * 100;
        const yPos = Math.random() * 100;

        particle.style.left = `${xPos}%`;
        particle.style.top = `${yPos}%`;

        // 随机大小
        const size = Math.random() * 5 + 2;
        particle.style.width = `${size}px`;
        particle.style.height = `${size}px`;

        // 随机颜色
        const hue = Math.random() * 60 + 240; // 蓝紫色调
        particle.style.backgroundColor = `hsl(${hue}, 80%, 70%)`;

        // 随机动画
        const duration = Math.random() * 10 + 5;
        const delay = Math.random() * 5;

        particle.style.animation = `float ${duration}s ease-in-out ${delay}s infinite`;

        // 随机透明度
        particle.style.opacity = Math.random() * 0.5 + 0.3;

        container.appendChild(particle);
      }
    }

    // 设置活动导航链接
    function setActiveNavLink() {
      const currentPath = window.location.pathname;
      document.querySelectorAll('.navbar-nav .nav-link').forEach(link => {
        const href = link.getAttribute('href');
        if (href === currentPath || (currentPath.startsWith(href) && href !== '/')) {
          link.classList.add('active');
        }
      });
    }

    // 设置活动推荐策略
    function setActiveStrategy(strategy) {
      document.querySelectorAll('.strategy-selector').forEach(selector => {
        if (selector.dataset.strategy === strategy) {
          selector.classList.add('active');
        } else {
          selector.classList.remove('active');
        }
      });
      state.currentStrategy = strategy;
    }

    // 加载用户数据
    function loadUserData() {
      // 在真实环境中，这里应该是一个AJAX请求
      // 模拟API调用
      setTimeout(() => {
        const userData = {
          id: 1,
          username: '{{ user.username }}',
          stats: {
            ratings: {{ user.profile.rating_count|default:"0" }},
            comments: {{ user.profile.comment_count|default:"0" }},
            favorites: {{ user.favorites.count|default:"0" }},
            history: {{ user.browsing_history.count|default:"0" }}
          }
        };

        // 更新状态
        state.userData = userData;

        // 更新UI
        document.getElementById('username').textContent = userData.username;

        // 更新统计数据
        animateStats(userData.stats);
      }, 800);
    }

    // 动画显示统计数据
    function animateStats(stats) {
      const statItems = document.querySelectorAll('#userStats .stat-item');

      statItems.forEach(item => {
        const type = item.dataset.type;
        const target = stats[type] || 0;
        const display = item.querySelector('.stat-number');
        const duration = 1500;
        const step = Math.max(1, Math.floor(target / (duration / 50)));

        let count = 0;
        const timer = setInterval(() => {
          count += step;
          if (count >= target) {
            display.textContent = target;
            clearInterval(timer);
          } else {
            display.textContent = count;
          }
        }, 50);
      });
    }

    // 加载推荐数据
    function loadRecommendations(strategy) {
      const container = document.getElementById('recommendationContainer');

      // 显示加载状态
      container.innerHTML = `
        <div class="loading-container">
          <div class="quantum-spinner"></div>
          <p class="mt-3">量子态计算中...</p>
        </div>
      `;

      // 如果已缓存该策略的推荐，直接使用
      if (state.recommendations[strategy]) {
        renderRecommendations(state.recommendations[strategy]);
        return;
      }

      // 模拟API调用
      setTimeout(() => {
        // 这里应该是一个AJAX请求到后端API
        // 模拟不同策略返回不同的推荐结果
        let recommendations;

        switch(strategy) {
          case 'hybrid':
            recommendations = [
              { id: 1, title: '动漫标题示例', image: 'https://via.placeholder.com/400x250', confidence: 87 },
              { id: 2, title: '进击的巨人', image: 'https://via.placeholder.com/400x250', confidence: 93 },
              { id: 3, title: '鬼灭之刃', image: 'https://via.placeholder.com/400x250', confidence: 81 },
              { id: 4, title: '间谍过家家', image: 'https://via.placeholder.com/400x250', confidence: 75 }
            ];
            break;
          case 'cf':
            recommendations = [
              { id: 5, title: '约定的梦幻岛', image: 'https://via.placeholder.com/400x250', confidence: 89 },
              { id: 6, title: '辉夜大小姐想让我告白', image: 'https://via.placeholder.com/400x250', confidence: 85 },
              { id: 7, title: '五等分的新娘', image: 'https://via.placeholder.com/400x250', confidence: 82 },
              { id: 8, title: '咒术回战', image: 'https://via.placeholder.com/400x250', confidence: 79 }
            ];
            break;
          case 'content':
            recommendations = [
              { id: 9, title: '海贼王', image: 'https://via.placeholder.com/400x250', confidence: 91 },
              { id: 10, title: '火影忍者', image: 'https://via.placeholder.com/400x250', confidence: 88 },
              { id: 11, title: '一拳超人', image: 'https://via.placeholder.com/400x250', confidence: 84 },
              { id: 12, title: '钢之炼金术师', image: 'https://via.placeholder.com/400x250', confidence: 77 }
            ];
            break;
          case 'ml':
            recommendations = [
              { id: 13, title: '东京喰种', image: 'https://via.placeholder.com/400x250', confidence: 90 },
              { id: 14, title: '工作细胞', image: 'https://via.placeholder.com/400x250', confidence: 87 },
              { id: 15, title: '刀剑神域', image: 'https://via.placeholder.com/400x250', confidence: 83 },
              { id: 16, title: '命运石之门', image: 'https://via.placeholder.com/400x250', confidence: 81 }
            ];
            break;
          case 'popular':
            recommendations = [
              { id: 17, title: '死亡笔记', image: 'https://via.placeholder.com/400x250', confidence: 95 },
              { id: 18, title: '灌篮高手', image: 'https://via.placeholder.com/400x250', confidence: 93 },
              { id: 19, title: '龙珠超', image: 'https://via.placeholder.com/400x250', confidence: 92 },
              { id: 20, title: '名侦探柯南', image: 'https://via.placeholder.com/400x250', confidence: 90 }
            ];
            break;
          default:
            recommendations = [];
        }

        // 缓存推荐结果
        state.recommendations[strategy] = recommendations;

        // 渲染推荐
        renderRecommendations(recommendations);
      }, 1200);
    }

    // 渲染推荐列表
    function renderRecommendations(recommendations) {
      const container = document.getElementById('recommendationContainer');

      if (!recommendations || recommendations.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">
              <i class="fas fa-film"></i>
            </div>
            <h5>暂无推荐</h5>
            <p>随着您观看更多动漫并进行评分，我们的推荐系统将为您提供更精准的个性化推荐</p>
            <a href="/anime/list/" class="btn btn-primary mt-2 rounded-pill">
              <i class="fas fa-play me-1"></i>浏览动漫
            </a>
          </div>
        `;
        return;
      }

      // 构建HTML
      let html = '';
      recommendations.forEach(anime => {
        html += `
          <div class="rec-card">
            <a href="/anime/${anime.id}/">
              <div class="rec-img-container">
                <img src="${anime.image}" alt="${anime.title}">
              </div>
            </a>
            <div class="rec-content">
              <h5 class="rec-title" title="${anime.title}">${anime.title}</h5>
              <div class="rec-confidence">
                <div class="d-flex justify-content-between small mb-1">
                  <span>匹配度</span>
                  <span>${anime.confidence}%</span>
                </div>
                <div class="confidence-bar">
                  <div class="confidence-level" style="width: 0%"></div>
                </div>
              </div>
            </div>
          </div>
        `;
      });

      container.innerHTML = html;

      // 动画展示置信度条
      setTimeout(() => {
        document.querySelectorAll('.confidence-level').forEach((bar, index) => {
          const confidence = recommendations[index].confidence;
          bar.style.width = `${confidence}%`;
        });
      }, 100);
    }

    // 加载用户活动数据
    function loadUserActivities() {
      // 异步加载评分数据
      setTimeout(() => {
        // 这里应该是AJAX请求或模板变量
        const ratings = {{ user_ratings|default:"[]"|safe }};

        state.ratings = ratings;
        renderRatings(ratings);
      }, 1500);

      // 异步加载评论数据
      setTimeout(() => {
        // 这里应该是AJAX请求或模板变量
        const comments = {{ user_comments|default:"[]"|safe }};

        state.comments = comments;
        renderComments(comments);
      }, 1800);
    }

    // 渲染评分记录
    function renderRatings(ratings) {
      const container = document.getElementById('ratingsContainer');

      if (!ratings || ratings.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">
              <i class="fas fa-star"></i>
            </div>
            <h5>暂无评分记录</h5>
            <p>您还没有给任何动漫评分，开始评分将帮助我们为您提供更准确的推荐</p>
            <a href="/anime/list/" class="btn btn-primary mt-2 rounded-pill">
              <i class="fas fa-play me-1"></i>开始评分
            </a>
          </div>
        `;
        return;
      }

      // 构建HTML
      let html = '<div class="activities-list">';
      ratings.forEach(rating => {
        // 生成星级HTML
        let starsHtml = '';
        for (let i = 1; i <= 5; i++) {
          if (i <= Math.floor(rating.rating)) {
            starsHtml += '<i class="fas fa-star text-warning"></i>';
          } else if (i - 0.5 <= rating.rating) {
            starsHtml += '<i class="fas fa-star-half-alt text-warning"></i>';
          } else {
            starsHtml += '<i class="far fa-star text-warning"></i>';
          }
        }

        html += `
          <div class="activity-item">
            <div class="activity-header">
              <div class="activity-title">
                <a href="/anime/${rating.animeId}/">${rating.animeTitle}</a>
              </div>
              <div class="activity-date">${rating.date}</div>
            </div>
            <div class="activity-content">
              评分: ${starsHtml} <span class="ms-1">${rating.rating}</span>
            </div>
          </div>
        `;
      });
      html += '</div>';

      container.innerHTML = html;
    }

    // 渲染评论记录
    function renderComments(comments) {
      const container = document.getElementById('commentsContainer');

      if (!comments || comments.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">
              <i class="fas fa-comment"></i>
            </div>
            <h5>暂无评论记录</h5>
            <p>您还没有发表任何评论</p>
          </div>
        `;
        return;
      }

      // 构建HTML
      let html = '<div class="activities-list">';
      comments.forEach(comment => {
        html += `
          <div class="activity-item">
            <div class="activity-header">
              <div class="activity-title">
                <a href="/anime/${comment.animeId}/">${comment.animeTitle}</a>
              </div>
              <div class="activity-date">${comment.date}</div>
            </div>
            <div class="activity-content">
              ${comment.content}
            </div>
          </div>
        `;
      });
      html += '</div>';

      container.innerHTML = html;
    }
  </script>
</body>
</html>